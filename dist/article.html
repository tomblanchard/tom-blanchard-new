<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>
      Freelance full-stack Shopify development - Lincolnshire, UK | Tom Blanchard
    </title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&family=Alfa+Slab+One&display=swap" />
    <link rel="stylesheet" href="/assets/theme.min.css" />

    
      <link rel="stylesheet" href="https://tomblanchard.co.uk/assets/prism-okaidia.min.css?v=8bd22fdfeb" />
    
  </head>

  <body>
    

<header class="box-color-definitions-1 text-color-definitions-2">
  <div class="padding-top-bottom--up-2 large--padding-top-bottom--up-3">
    <div class="container-default">
      <div class="large--flex-bar--up-1">
        <div class="large--flex-item">
          <div class="font-stack-heading font-size--up-5 large--font-size--up-10 line-height--none text-color-definitions-3 margin-bottom--down-1 large--margin-bottom--none">
            <a class="text-color-inherit" href="/">
              Tom Blanchard.
            </a>
          </div>
        </div>

        <div class="large--flex-item-shrink">
          <nav class="nowrap container-margin-negative-x large--margin--none scroll-horizontal">
            <div class="container-padding large--padding--none">
              <ul class="grid-bar--up-3 large--text-right margin-bottom--none">
                
                  

                  

                  

                  
                    
                  

                  <li class="grid-item">
                    <a class="text-color-inherit font-size--down-2 line-height--up-4 font-weight-600 text-caps" href="/#about">
                      About
                    </a>
                  </li>
                
                  

                  

                  

                  
                    
                  

                  <li class="grid-item">
                    <a class="text-color-inherit font-size--down-2 line-height--up-4 font-weight-600 text-caps" href="/#testimonials">
                      Testimonials
                    </a>
                  </li>
                
                  

                  

                  

                  
                    
                  

                  <li class="grid-item">
                    <a class="text-color-inherit font-size--down-2 line-height--up-4 font-weight-600 text-caps" href="/#case-studies">
                      Case Studies
                    </a>
                  </li>
                
                  

                  

                  

                  
                    
                      
                    
                  

                  <li class="grid-item">
                    <a class="text-color-inherit font-size--down-2 line-height--up-4 font-weight-600 text-caps" href="/blog.html">
                      Blog
                    </a>
                  </li>
                
                  

                  

                  

                  
                    
                  

                  <li class="grid-item">
                    <a class="text-color-inherit font-size--down-2 line-height--up-4 font-weight-600 text-caps" href="/#contact">
                      Contact
                    </a>
                  </li>
                

                <li class="grid-item">
                  <div class="container-padding padding-left--none large--padding--none">
                    



<ul class="grid-bar--0 margin-bottom--none">
  
    

    <li class="grid-item">
      <a class="text-color-inherit" href="https://linkedin.com/in/tom-blanchard-7b906a163" target="_blank">
        <div class="font-size--up-8">
          
          <svg viewBox="0 0 26 26">
  <circle cx="13" cy="13" r="13"/><path d="M9.557 19h-2.36V9.947h2.36V19zM8.377 8.904C7.617 8.904 7 8.254 7 7.452 7 6.65 7.617 6 8.377 6s1.377.65 1.377 1.452c0 .801-.616 1.452-1.377 1.452zM19 19h-2.36v-4.612c0-2.772-3.148-2.562-3.148 0V19h-2.36V9.947h2.36V11.4C14.59 9.27 19 9.114 19 13.437V19z" fill="#000" fill-rule="nonzero"/>
</svg>

        </div>
      </a>
    </li>
  
    

    <li class="grid-item">
      <a class="text-color-inherit" href="https://twitter.com/tomblanchardCSS" target="_blank">
        <div class="font-size--up-8">
          
          <svg viewBox="0 0 26 26">
  <circle cx="13" cy="13" r="13"/><path d="M20.167 7.539a5.963 5.963 0 01-1.787.517 3.262 3.262 0 001.368-1.816 6.041 6.041 0 01-1.976.796A3.034 3.034 0 0015.5 6c-2.009 0-3.485 1.977-3.031 4.03-2.585-.137-4.878-1.444-6.413-3.43-.815 1.476-.423 3.405.962 4.382a2.977 2.977 0 01-1.408-.41c-.034 1.52.999 2.942 2.495 3.26a2.962 2.962 0 01-1.405.055c.396 1.304 1.544 2.252 2.907 2.279A6.026 6.026 0 015 17.526 8.48 8.48 0 009.77 19c5.777 0 9.041-5.146 8.844-9.762a6.539 6.539 0 001.553-1.699z" fill="#000" fill-rule="nonzero"/>
</svg>

        </div>
      </a>
    </li>
  
    

    <li class="grid-item">
      <a class="text-color-inherit" href="http://github.com/tomblanchard" target="_blank">
        <div class="font-size--up-8">
          
          <svg viewBox="0 0 26 26">
  <circle cx="13" cy="13" r="13"/><path d="M13 4c-4.97 0-9 4.132-9 9.228 0 4.077 2.579 7.535 6.155 8.756.45.085.595-.201.595-.444v-1.718c-2.503.558-3.025-1.089-3.025-1.089-.41-1.066-1-1.35-1-1.35-.816-.573.063-.56.063-.56.904.064 1.379.95 1.379.95.803 1.41 2.105 1.003 2.619.767.08-.596.314-1.003.572-1.233-2-.235-4.1-1.026-4.1-4.56 0-1.009.351-1.832.926-2.478-.093-.233-.401-1.172.088-2.442 0 0 .756-.247 2.476.946A8.432 8.432 0 0113 8.463a8.457 8.457 0 012.255.31c1.718-1.193 2.472-.946 2.472-.946.49 1.271.182 2.21.089 2.442.577.646.926 1.47.926 2.477 0 3.544-2.105 4.325-4.11 4.553.323.286.618.848.618 1.709v2.532c0 .245.144.534.6.443 3.575-1.222 6.15-4.68 6.15-8.755C22 8.132 17.97 4 13 4z" fill="#000" fill-rule="nonzero"/>
</svg>

        </div>
      </a>
    </li>
  
</ul>

                  </div>
                </li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>
</header>


    <main>
      
  <div class="padding-top-bottom--up-3 large--padding-top-bottom--up-7">
  <div class="container-default">
    <article class="box-center" style="max-width: 875px;">
      <header class="margin-bottom--down-1 large--margin-bottom--up-1">
        <div class="flex-vertical-reverse">
          <h1 class="font-size--up-6 line-height--up-10 large--font-size--up-10 large--line-height--up-14 text-color-definitions-3 margin-bottom--none">
            Handling lazy-loaded image reflows in Shopify themes
          </h1>

          <div class="margin-bottom--down-1">
            <div class="font-size--0 large--font-size--up-4 large--line-height--up-10 text-color-definitions-4">
              <time datetime="2018-11-30">
                30 November 2018
              </time>
            </div>
          </div>
        </div>
      </header>

      <div class="rte">
        
<p>I recently worked on a Shopify theme project where images uploaded to the products on this store were all quite large in height compared to their width, a grid of the products looks something like this:</p>
<p><img src="https://tomblanchard.co.uk/content/images/2018/05/square-cropped-product-images-shopify-themes-product-grid.gif" alt="Product grid"></p>
<p>Shopify will generate a lot of images from each image uploaded to a product, all with different sizes, these sizes are documented <a href="http://docs.shopify.com/themes/liquid-documentation/filters/url-filters#size-parameters">here</a>. The problem I faced is that the different sized images generated all preserve the original aspect ratio (which is expected I guess), for example, if I uploaded an image which was <code>600x975px</code> and used the <code>large</code> generated size variation of this image it would be <code>295x480px</code> because the <code>large</code> image size returns the image at a <em>maximum</em> size of <code>480x480px</code> pixels whilst preserving the original aspect ratio. This is how you use the image with the preserved original aspect ratio:</p>
<pre><code class="language-markup">&lt;img src=&quot;{{ image.src | img_url: 'large' }}&quot; alt=&quot;{{ image.alt | escape }}&quot;&gt;
</code></pre>
<p>What if I wanted to use a square cropped version of this image like you can with WordPress? Well it turns out Shopify generates a <code>cropped</code> variation of each image uploaded to a product too, but for some reason this isn't documented anywhere. This is how you use the square cropped version of the image:</p>
<pre><code class="language-markup">{% assign cropped_img_size = 'large' %}
{% assign cropped_img = image.src | img_url: cropped_img_size | replace: '.jpg', '_cropped.jpg' | replace: '.gif', '_cropped.gif' | replace: '.png', '_cropped.png' %}

&lt;img src=&quot;{{ cropped_img }}&quot; alt=&quot;{{ image.alt | escape }}&quot;&gt;
</code></pre>
<p>The best thing about the cropped variation is that you can still use any of the already documented <a href="http://docs.shopify.com/themes/liquid-documentation/filters/url-filters#size-parameters">image sizes</a>, just change the <code>cropped_img_size</code> variable to what size you want. So the above code would spit out a <code>480x480px</code> image from any size image uploaded to the product, even very small images (below <code>480x480px</code>), small images get enlarged to fit the square. The only caveat I've found with this method is that you can't control the crop position, both the <code>x</code> and <code>y</code> axis crop positions default to <code>center</code> and cannot be changed.</p>
<h2 id="myusecase">My use case</h2>
<p>I needed this functionality because the product images needed to be responsive, what I mean by this is that on large displays the longer image should be displayed, but on smaller displays the square cropped image should be displayed instead (<a href="http://usecases.responsiveimages.org/#art-direction">art directed</a> responsive images). This is how I did it on the <code>product.liquid</code> template; listing all the images uploaded to the product, with a little help from <a href="http://scottjehl.github.io/picturefill">Picturefill</a>.</p>
<pre><code class="language-markup">{% for image in product.images %}

  {% assign img = image.src | img_url: 'grande' %}
  {% assign cropped_img = img | replace: '.jpg', '_cropped.jpg' | replace: '.gif', '_cropped.gif' | replace: '.png', '_cropped.png' %}

  &lt;picture&gt;
    &lt;source srcset=&quot;{{ img }}&quot; media=&quot;(min-width: 768px)&quot;&gt;
    &lt;source srcset=&quot;{{ cropped_img }}&quot; media=&quot;(max-width: 767px)&quot;&gt;
    &lt;img srcset=&quot;{{ img }}&quot; alt=&quot;{{ image.alt | escape }}&quot;&gt;
  &lt;/picture&gt;

{% endfor %}
</code></pre>
<p><a href="https://css-tricks.com/the-complete-guide-to-lazy-loading-images/">Lazy loading images</a> is a pretty common practice nowadays, why load all images on each page if you can't garuantee your users will actually see them? To prevent your users from downloading every image, you can instead load all images which are visible/close to being visible within the users browser viewport as they scroll.</p>
<p>There's a <a href="https://github.com/search?q=lazy+load">ton of libraries</a> in the wild which implement lazy loading functionality, I'd reccomend to do some research and choose one that fits your needs or even roll your own. The only assumption I'll make here is that your markup for a lazy-loaded image looks something like this:</p>
<pre><code>&lt;img data-src=&quot;//domain.com/image.jpg&quot; alt=&quot;&quot; /&gt;
</code></pre>
<p>This image will only load when it's visible/close to being visible within the users browser viewport.</p>
<p>Here's a screenshot of the page we'll be building:</p>
<p><img src="https://tomblanchard.co.uk/content/images/2018/11/1-copy.jpg" alt="1-copy"></p>
<p>The content will be fed from a Section:</p>
<pre><code>{% schema %}
  {
    &quot;name&quot;: &quot;About&quot;,
    &quot;settings&quot;: [
      {
        &quot;type&quot;: &quot;text&quot;,
        &quot;id&quot;: &quot;title&quot;,
        &quot;label&quot;: &quot;Title&quot;
      },
      {
        &quot;type&quot;: &quot;image_picker&quot;,
        &quot;id&quot;: &quot;image&quot;,
        &quot;label&quot;: &quot;Image&quot;
      },
      {
        &quot;type&quot;: &quot;richtext&quot;,
        &quot;id&quot;: &quot;copy&quot;,
        &quot;label&quot;: &quot;Copy&quot;
      }
    ]
  }
{% endschema %}

{% assign title = section.settings.title %}

{% assign image = section.settings.image %}
{% assign image_url = image | img_url: '2000x' %}

{% assign copy = section.settings.copy %}

&lt;h1&gt;
  {{ title }}
&lt;/h1&gt;

&lt;img data-src=&quot;{{ image_url }}&quot; alt=&quot;&quot; /&gt;

&lt;div class=&quot;rte&quot;&gt;
  {{ copy }}
&lt;/div&gt;
</code></pre>
<p>Here's a video of this page loading on a fast 3G connection:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/MQ7vyoZKhO0?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Notice how initially, the copy text is visible, then once the image has loaded, the content reflows and the text gets pushed out of view underneath the image. This happens due to the browser having no knowledge of the image prior to it loading, including the image width and height.</p>
<p>We're working with a <a href="https://help.shopify.com/en/themes/liquid/objects/image">Shopify &quot;image&quot; object</a> here which provides extra info about the image, including it's width and height; if we have access to this info prior to downloading the image in the browser, we can work out it's aspect ratio like so:</p>
<pre><code>{% assign image_box_ratio = image.height | append: &quot;.0&quot; | times: 1 | divided_by: image.width | times: 100 | append: &quot;%&quot; %}
</code></pre>
<p>From there, you can wrap the image in a container which uses this aspect ratio:</p>
<pre><code>&lt;div style=&quot;--box-ratio: {{ image_box_ratio }};&quot;&gt;
  &lt;img data-src=&quot;{{ image_url }}&quot; alt=&quot;&quot; /&gt;
&lt;/div&gt;
</code></pre>
<p>Sprinkle in some CSS:</p>
<pre><code>[style*=&quot;--box-ratio:&quot;] {
  height: 0;
  padding-bottom: var(--box-ratio);
  background: #F8F8F8;
}
</code></pre>
<p>The Section will look like this:</p>
<pre><code>{% schema %}
  {
    &quot;name&quot;: &quot;About&quot;,
    &quot;settings&quot;: [
      {
        &quot;type&quot;: &quot;text&quot;,
        &quot;id&quot;: &quot;title&quot;,
        &quot;label&quot;: &quot;Title&quot;
      },
      {
        &quot;type&quot;: &quot;image_picker&quot;,
        &quot;id&quot;: &quot;image&quot;,
        &quot;label&quot;: &quot;Image&quot;
      },
      {
        &quot;type&quot;: &quot;richtext&quot;,
        &quot;id&quot;: &quot;copy&quot;,
        &quot;label&quot;: &quot;Copy&quot;
      }
    ]
  }
{% endschema %}

{% assign title = section.settings.title %}

{% assign image = section.settings.image %}
{% assign image_url = image | img_url: '2000x' %}
{% assign image_box_ratio = image.height | append: &quot;.0&quot; | times: 1 | divided_by: image.width | times: 100 | append: &quot;%&quot; %}

{% assign copy = section.settings.copy %}

&lt;h1&gt;
  {{ title }}
&lt;/h1&gt;

&lt;div style=&quot;--box-ratio: {{ image_box_ratio }};&quot;&gt;
  &lt;img data-src=&quot;{{ image_url }}&quot; alt=&quot;&quot; /&gt;
&lt;/div&gt;

&lt;div class=&quot;rte&quot;&gt;
  {{ copy }}
&lt;/div&gt;
</code></pre>
<p>With that in place, the loading experience has dramatically improved:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/51TrfWc63OM?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Notice how the image is displayed as an empty placeholder (grey) box before the image is actually downloaded, once the image has loaded, there's no content jump because the grey box uses the same aspect ratio as the image itself.</p>
<p>I use this method throughout all Shopify sites I build and work on, it's such a huge performance boost with very minimal effort.</p>
<h2 id="whataboutimageswhicharentimageobjects">What about images which aren't &quot;image&quot; objects?</h2>
<p>It's quite common to have theme references to image URLs instead of &quot;image&quot; objects when you use metafields to store data via a metafield editor app. Depending on the app, this method is still possible with a bit of tweaking - I make use out of <a href="https://apps.shopify.com/accentuate">Accentuate Custom Fields</a> when I need resources to have non-global section data (e.g. each collection needs a different hero image).</p>
<p>While Accentuate supports an &quot;image&quot; field type, it's impossible for it to return an actual &quot;image&quot; object due to the limiations of metafields; it just returns an image URL:</p>
<pre><code>{{ collection.metafields.accentuate.hero_image }}
</code></pre>
<p>Will return an image URL like:</p>
<pre><code>https://cdn.accentuate.io/69262540870/4651314610246/image.jpg?2000Ã—1334
</code></pre>
<p>This URL contains the image width and height in the query paramters; we can take advantage of this to calculate it's aspect ratio like this:</p>
<pre><code>{% assign image_url =  collection.metafields.accentuate.hero_image %}
{% assign image_url_width = image_url | split: &quot;?&quot; | last | split: &quot;x&quot; | first | times: 1 %}
{% assign image_url_height = image_url | split: &quot;?&quot; | last | split: &quot;x&quot; | last | times: 1 %}
{% assign image_url_box_ratio = image_url_height | append: &quot;.0&quot; | times: 1 | divided_by: image_url_width | times: 100 | append: &quot;%&quot; %}
</code></pre>
<p>We can then use it like this:</p>
<pre><code>&lt;div style=&quot;--box-ratio: {{ image_url_box_ratio }};&quot;&gt;
  &lt;img data-src=&quot;{{ image_url }}&quot; alt=&quot;&quot; /&gt;
&lt;/div&gt;
</code></pre>

<p>Shopify comes with a pretty good file storage solution, <a href="https://help.shopify.com/en/manual/sell-online/online-store/file-uploads">as documented on their help center</a>, you can upload, manage, and delete files from the Files page in Shopify. All files uploaded to Shopify end up here, this means all product images, collections images and images uploaded via Theme/Section settings.</p>
<p>You can upload many files at once using the uploader, you can delete multiple files using the bulk actions toolbar but one very strange quirk is that you cannot bulk-download these files. This is a huge problem when migrating from one Shopify store to another, think moving from a development shop to the merchant's production shop.</p>
<p>I figured out a way to bulk-download these files, it involves scraping the client-side admin UI code via the browser development tools Javascript console then using a Node.js script to download the files to your local machine.</p>
<p>If you need to do this, start off by making sure you've got Node.js installed on your machine, <a href="https://nodejs.org/en/">download and run the installer from the Node.js website</a> - opt for the version which they state &quot;Recommended For Most Users&quot;.</p>
<p>Next, open a Terminal window, if you're not sure how to do that, <a href="https://www.wikihow.com/Open-a-Terminal-Window-in-Mac">see this tutorial</a>.</p>
<p>Now, <a href="https://github.com/tomblanchard/shopify-bulk-file-downloader/archive/master.zip">click this link</a> to download the Shopify Bulk File Downloader, save it to your desktop and unzip it.</p>
<p>Open your Terminal window and run the command <code>cd ~/Desktop/shopify-bulk-file-downloader-master</code>, then run the command <code>npm i</code>.</p>
<p>Next up, <a href="https://raw.githubusercontent.com/tomblanchard/shopify-bulk-file-downloader/master/client.min.js">click this link</a>, select all the code and copy it to your clipboard, with that code copied head over to the Files page of your Shopify acccount, that looks like this:</p>
<p><a href="https://shop.myshopify.com/admin/settings/files">https://shop.myshopify.com/admin/settings/files</a></p>
<p>With this page open, open the Chrome Developer Tools (View -&gt; Developer -&gt; Development Tools) then click the &quot;Console&quot; tab, paste the code copied to your clipboard in here and press the Enter key - eventually you'll see an alert which states &quot;File URLS have been copied to your clipboard!&quot;.</p>
<p>Now head over to your Desktop directory in Finder and open the file <code>file-urls.json</code>, you can open this on any text-editing app (TextEdit, Notepad, etc.) and paste the results into this file, save and close it.</p>
<p>Go back to your Terminal window and run the command <code>node server</code>, a new directory will be created in the <code>shopify-bulk-file-downloader-master</code> directory called &quot;files&quot;, all files will be downloaded there and you'll see a &quot;Success!&quot; message in the Terminal when finished.</p>
<p>Enjoy. :)</p>
<p>When developing apps with Express, at some point you'll probably need to store user data across different requests, that's where sessions come in. I was using <a href="https://github.com/expressjs/session">express-session</a> when I came across an issue, I needed to store <a href="https://github.com/MONEI/Shopify-api-node">Shopify-api-node</a> instances across sessions.</p>
<p>This is how the app was structured at first:</p>
<pre><code class="language-javascript">// entry-index.js

var express = require(&quot;express&quot;);
var session = require(&quot;express-session&quot;);
var RedisStore = require(&quot;connect-redis&quot;)(session);

var middlewareShopify = require(&quot;./middleware-shopify&quot;);
var routerRoutes = require(&quot;./router-routes&quot;);

var app = express();
var appPort = process.env.PORT || 3000;

app.use(session({
  store: new RedisStore({ host: &quot;localhost&quot;, port: 6379, ttl: 260 }),
  secret: &quot;gu2cQL7z2z4pKypm&quot;,
  resave: false,
  saveUninitialized: true
}));

app.use(middlewareShopify);
app.use(routerRoutes);

app.listen(appPort, () =&gt; {
  console.log(`App listening on port ${appPort}!`);
});
</code></pre>
<pre><code class="language-javascript">// middleware-shopify.js

module.exports = (req, res, next) =&gt; {
  if( !req.session.shopName || !req.session.apiKey || !req.session.password ) {
    req.session.shopName = req.query.shopName;
    req.session.apiKey = req.query.apiKey;
    req.session.password = req.query.password;
  }

  var { shopName, apiKey, password }  = req.session;

  if( !shopName || !apiKey || !password ) {
    return res.status(500).send(&quot;Something broke.&quot;);
  }

  return next();
};
</code></pre>
<pre><code class="language-javascript">// routes-routes.js

var express = require(&quot;express&quot;);

var Shopify = require(&quot;shopify-api-node&quot;);

var router = express.Router();

router.get(&quot;/&quot;, (req, res) =&gt; {
  var { shopName, apiKey, password }  = req.session;

  var shopify = new Shopify({
    shopName,
    apiKey,
    password,
    autoLimit: true
  });

  shopify.shop.get()
    .then((shop) =&gt; {
      return res.send(JSON.stringify(shop));
    })
    .catch((err) =&gt; {
      return res.status(500).send(&quot;Something broke.&quot;);
    });
});

router.get(&quot;/other-route&quot;, (req, res) =&gt; {
  var { shopName, apiKey, password }  = req.session;

  var shopify = new Shopify({
    shopName,
    apiKey,
    password,
    autoLimit: true
  });

  shopify.shop.get()
    .then((shop) =&gt; {
      return res.send(JSON.stringify(shop));
    })
    .catch(() =&gt; {
      return res.status(500).send(&quot;Something broke.&quot;);
    });
});

module.exports = router;
</code></pre>
<p>This works like so:</p>
<ol>
<li>Visit the URL: <a href="https://localhost:3000">https://localhost:3000</a> and you'll get an error due to the lack of required query parameters (<code>shopName</code>, <code>apiKey</code> and <code>password</code>).</li>
<li>Visit a URL like: <a href="http://localhost:3000/?shopName=your-shop-name&amp;apiKey=your-api-key&amp;password=your-app-password">http://localhost:3000/?shopName=your-shop-name&amp;apiKey=your-api-key&amp;password=your-app-password</a> and you'll see data displayed from an API call to the <code>your-shop-name</code> shop.</li>
<li>The query parameters are now saved to your session, so you can now visit routes without the query parameters and it'll still work.</li>
</ol>
<p>This is great and <em>almost</em> works exactly how I want, but there's one issue; every route defines a new <code>Shopify</code> instance. If you take a look at the <a href="https://github.com/MONEI/Shopify-api-node">Shopify-api-node</a> documentation, you'll see it provides a <code>autoLimit</code> option, this is a simple way around hitting the <a href="https://help.shopify.com/api/getting-started/api-call-limit">Shopify API call limit</a>. The only catch is that for <code>autoLimit</code> to work properly, there needs to be just <em>one</em> <code>Shopify</code> instance per shop.</p>
<p>My first thought was to setup the <code>Shopify</code> instance in the <code>middleware-shopify</code> middleware, like this:</p>
<pre><code class="language-javascript">// middleware-shopify.js

var Shopify = require(&quot;shopify-api-node&quot;);

module.exports = (req, res, next) =&gt; {
  if( !req.session.shopName || !req.session.apiKey || !req.session.password ) {
    req.session.shopName = req.query.shopName;
    req.session.apiKey = req.query.apiKey;
    req.session.password = req.query.password;
  }

  var { shopName, apiKey, password }  = req.session;

  if( !shopName || !apiKey || !password ) {
    return res.status(500).send(&quot;Something broke.&quot;);
  }

  if( !req.session.shopify ) {
    req.session.shopify = new Shopify({
      shopName,
      apiKey,
      password,
      autoLimit: true
    });
  }

  return next();
};
</code></pre>
<p>Then in my <code>router-routes.js</code> router, I could use it like this:</p>
<pre><code class="language-javascript">router.get(&quot;/&quot;, (req, res) =&gt; {
  var { shopify }  = req.session;

  shopify.shop.get()
    .then((shop) =&gt; {
      return res.send(JSON.stringify(shop));
    })
    .catch((err) =&gt; {
      return res.status(500).send(&quot;Something broke.&quot;);
    });
});
</code></pre>
<p>This doesn't work because you can only store JSON-serializable data in  <code>req.session</code>, instances can't be serialized. What I ended up doing was creating a session/<code>Shopify</code> instance map, each session gets it's own <code>Shopify</code> instance, identified via the <code>session.id</code>. I started off by creating a new <code>object-shopifys.js</code> file which exports an empty object:</p>
<pre><code>// object-shopifys.js

module.exports = {};
</code></pre>
<p>I then changed the <code>middleware-shopify</code> middleware, like this:</p>
<pre><code class="language-javascript">// middleware-shopify.js

var Shopify = require(&quot;shopify-api-node&quot;);

var shopifys = require(&quot;./object-shopifys&quot;);

module.exports = (req, res, next) =&gt; {
  if( !req.session.shopName || !req.session.apiKey || !req.session.password ) {
    req.session.shopName = req.query.shopName;
    req.session.apiKey = req.query.apiKey;
    req.session.password = req.query.password;
  }

  var { shopName, apiKey, password }  = req.session;

  if( !shopName || !apiKey || !password ) {
    return res.status(500).send(&quot;Something broke.&quot;);
  }

  if( !shopifys[req.session.id] ) {
    shopifys[req.session.id] = new Shopify({
      shopName,
      apiKey,
      password,
      autoLimit: true
    });
  }

  return next();
};
</code></pre>
<p>By default, the <code>shopifys</code> object is empty, but after the middleware has executed for the first time of the users session, it'll look like:</p>
<pre><code class="language-javascript">// `Shopify...` refers to the actual instance, I left it out
// due to brevity.
{
  &quot;Xur_jku_V-pUfwu3tuNtAqEydp8CTxbK&quot;: Shopify...
}
</code></pre>
<p>I then changed the router to reference the new <code>shopifys</code> object:</p>
<pre><code class="language-javascript">// router-routes.js

var express = require(&quot;express&quot;);

var shopifys = require(&quot;./object-shopifys&quot;);

var router = express.Router();

router.get(&quot;/&quot;, (req, res) =&gt; {
  var shopify = shopifys[req.session.id];

  shopify.shop.get()
    .then((shop) =&gt; {
      return res.send(JSON.stringify(shop));
    })
    .catch((err) =&gt; {
      return res.status(500).send(&quot;Something broke.&quot;);
    });
});

router.get(&quot;/other-route&quot;, (req, res) =&gt; {
  var shopify = shopifys[req.session.id];

  shopify.shop.get()
    .then((shop) =&gt; {
      return res.send(JSON.stringify(shop));
    })
    .catch(() =&gt; {
      return res.status(500).send(&quot;Something broke.&quot;);
    });
});

module.exports = router;
</code></pre>
<p>There we go, each session gets one <code>Shopify</code> instance and we don't have to worry about hitting the API call limit if we navigate to multiple API-heavy routes at the same time.</p>
<p>One thing we do have to worry about is a potential memory leak. Over time the <code>shopifys</code> object will build up and get larger. A simple solution would be to setup a cron-job which periodically checks the session IDs in the <code>shopifys</code> map and compares them to the redis <code>sess:*</code> keys, if the key no longer exists in redis, then remove it from the <code>shopifys</code> map.</p>
<p>I'd like to thank <a href="https://github.com/lpinca">Luigi Pinca</a> (the main contributer of the <a href="https://github.com/MONEI/Shopify-api-node">Shopify-api-node module</a>) for walking me through this on a <a href="https://github.com/MONEI/Shopify-api-node/issues/191">GitHub issue</a> I opened.</p>
<p>I recently spent a couple of days building a tool in the form of a small web app <a href="https://shopify-liquid-repl.tomblanchard.co.uk/">Shopify Liquid REPL</a>, it's similiar to the <a href="https://babeljs.io/repl/">Bable REPL</a>, but it takes Shopify Liquid (different to <a href="https://github.com/Shopify/liquid">vanilla Liquid</a>) and outputs the compiled code.</p>
<p>I built this because I was tired of spinning up a new development shop/theme every time I wanted to simply test out the capabilities of Liquid, I used to rely on another tool named <a href="https://droppen.org/">DropPen</a> for this, but that seems to be broken nowadays.</p>
<p>I originally planned on using <a href="https://github.com/Shopify/liquid">Shopify/liquid</a> (what I call &quot;vanilla Liquid&quot;) on my own server and handling the compiling through that, but there's quite a lot of differences between vanilla Liquid and the Liquid used on the actual Shopify servers. As stated <a href="https://github.com/Shopify/slate/wiki/Local-development">here</a>, Shopify claim:</p>
<blockquote>
<p>Shopify Themes use <a href="https://help.shopify.com/themes/liquid">an extended version of Liquid</a> with a variety of additional objects, tags, and filters</p>
</blockquote>
<p>For my REPL to function properly, the input Liquid needs to be run through the actual Shopify servers, luckily this isn't <em>too</em> hard when you combine usage of the <a href="https://help.shopify.com/api/reference">REST Admin API</a> with <a href="https://ecommerce.shopify.com/c/ecommerce-design/t/alternate-index-template-162420/#comment-162427">the ability to access alternative theme templates via a <code>view</code> query paramater</a>. The mechanism behind this works like this:</p>
<ul>
<li>Get Liquid input from the form POST data</li>
<li>Upload the Liquid input as a new alternate template via the <a href="https://help.shopify.com/api/reference/online_store/asset">Asset API</a>, e.g. <code>/templates/index.1nfn38hgj38g.liquid</code></li>
<li>Request the shop with the new alternate tempalte active, e.g. <code>https://shop-name.myshopify.com/?view=1nfn38hgj38g</code></li>
<li>Return the content</li>
<li>Delete the alternate template from the theme</li>
</ul>
<p>My Express route for this looks like:</p>
<pre><code class="language-javascript">app.post(&quot;/&quot;, (req, res) =&gt; {
  // Get Liquid input from the form POST data
  var input = `{% layout none %}${req.body.input}`;

  // https://github.com/klughammer/node-randomstring
  var template_suffix = randomstring.generate({
    length: 12,
    charset: &quot;alphabetic&quot;
  });

  var asset_key = `templates/index.${template_suffix}.liquid`;

  // Upload the Liquid input as a new alternate template
  shopify.asset.create(shop_theme_id, {
    &quot;key&quot;: asset_key,
    &quot;value&quot;: input
  })
    .then(() =&gt; {
      // Request the shop with the new alternate tempalte active
      return request({
        url: `${shop_url}/?view=${template_suffix}`,
        headers: { &quot;User-Agent&quot;: &quot;Mozilla&quot; }
      });
    })
    .then((template_res) =&gt; {
      // Delete the alternate template from the theme
      shopify.asset.delete(shop_theme_id, {
        asset: {
          &quot;key&quot;: asset_key
        }
      });

      // Return the content
      return res.send(template_res);
    });
});
</code></pre>
<p>Now on the front-end we just need a form like:</p>
<pre><code class="language-markup">&lt;form method=&quot;post&quot; action=&quot;/&quot;&gt;
  &lt;textarea name=&quot;input&quot;&gt;&lt;/textarea&gt;
  &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
&lt;/form&gt;
</code></pre>
<p>That'll hit the Express route and give us the compiled Liquid output. I wanted a split-screen editor so I do this via AJAX with an input field to the left and the output field to the right.</p>
<p>In the end I opted to develop the entire front-end with <a href="https://polaris.shopify.com/">Shopify Polaris</a> - Shopifys own app React powered JS framework. I broke everything down into their own dedicated components, moved all state and methods into a container component <code>EditorContainer</code> and used the new <a href="https://medium.com/dailyjs/reacts-%EF%B8%8F-new-context-api-70c9fe01596b">React 16.3.0 Context API</a> to <a href="https://itnext.io/compound-components-with-react-v16-3-6679c752bd56">avoid prop-drilling</a>.</p>
<p>You can see the source code to the app on <a href="https://github.com/tomblanchard/shopify-liquid-repl">my GitHub</a>.</p>
<p>After spending a fair amount of time spent tweaking existing &quot;off-the-shelf&quot; Shopify themes, I've come to realise one of my biggest annoyances with them (most of them anyways, some of them are genuinely beautifully coded.) It's not the lack of CSS structure / conventions, it's not the massive spaghetti code Javascript file, it's not even the never-ending theme settings (newsflash: no site needs over 20 colour options); it's the ridiculously long HTML attributes filled with Liquid logic.</p>
<p>What I'm talking about looks something like this:</p>
<pre><code class="language-markup">&lt;div class=&quot;collection-banner&quot; style=&quot;{% if settings.collection_header_bg_color != blank %}background-color: {{ settings.collection_header_bg_color }};{% endif %} {% if collection.image %}background-image: url('{{ collection.image | img_url: 'master' }}');{% endif %}&quot;&gt;
  &lt;div class=&quot;columns sixteen {% if settings.collection_image_text_align == 'left' %}text-align-left{% elsif settings.collection_image_text_align == 'right' %}text-align-right{% else %}text-align-center{% endif %}&quot;&gt;
    &lt;h1 class=&quot;headline&quot; style=&quot;{% if settings.collection_image_text_color != blank %}color: {{ settings.collection_image_text_color }};{% endif %}&quot;&gt;
      {{ collection.title }}
    &lt;/h1&gt;

    &lt;p class=&quot;subtitle&quot; style=&quot;{% if settings.collection_image_text_color_2 != blank %}color: {{ settings.collection_image_text_color_2 }};{% endif %}&quot;&gt;
      {{ collection.description }}
    &lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>I can't express how much I loathe working with code like the above, the logic-filled HTML attributes cause so much unreadability, it's a mess and it makes debugging a bit of a nightmare.</p>
<p>I've started to use a little convention to avoid this problem, it involves creating a lot of variables, but separates the logic from the attributes pretty nicely. The above [bad] code could be re-factored to the following [improved] code:</p>
<pre><code class="language-markup">{% assign bg_color = settings.collection_header_bg_color %}
{% assign bg_color_style = &quot;background-color:&quot; | append: bg_color | append: &quot;;&quot; %}
{% if bg_color == blank %} {% assign bg_color_style = &quot;&quot; %} {% endif %}

{% assign bg_image = collection.image %}
{% assign bg_image_src = bg_image | img_url: &quot;master&quot; %}
{% assign bg_image_style = &quot;background-image: url(&quot; | append: bg_image_src | append: &quot;);&quot; %}
{% unless bg_image %} {% assign bg_image_style = &quot;&quot; %} {% endunless %}

{% assign text_align = settings.collection_image_text_align %}
{% assign text_align_class = &quot;text-&quot; | append: text_align %}

{% assign headline_color = settings.collection_image_text_color %}
{% assign headline_color_style = &quot;color:&quot; | append: headline_color | append: &quot;;&quot; %}
{% if headline_color == blank %} {% assign headline_color_style = &quot;&quot; %} {% endif %}

{% assign description_color = settings.collection_image_text_color_2 %}
{% assign description_color_style = &quot;color:&quot; | append: description_color | append: &quot;;&quot; %}
{% if description_color == blank %} {% assign description_color_style = &quot;&quot; %} {% endif %}

&lt;div class=&quot;collection-banner&quot; style=&quot;{{ bg_color_style }} {{ bg_image_style }}&quot;&gt;
  &lt;div class=&quot;columns sixteen {{ text_align_class }}&quot;&gt;
    &lt;h1 class=&quot;headline&quot; style=&quot;{{ headline_color_style }}&quot;&gt;
      {{ collection.title }}
    &lt;/h1&gt;

    &lt;p class=&quot;subtitle&quot; style=&quot;{{ description_color_style }}&quot;&gt;
      {{ collection.description }}
    &lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>There we go, our logic and markup are completely separated now. You could argue that at 31 lines of code, this brings in the re-factored version at almost three times the size of the original 11 line version and that this is &quot;bad&quot;, but it really isn't; more lines of code != worse code, in this case it's 10x more readable and pretty much self-documenting, which is awesome!</p>
<p>As long as the above code is kept in it's own snippet (something like <code>snippets/collection-header.liquid</code>), as most of the main components of each template should be, then I think it's completely fine. It's not like we're adding bloat to the front-end and sacrificing load times for a little developer convenience / code readability, we're just throwing a few more lines of Liquid at the blazing fast Shopify servers, which is no biggie at all.</p>
<p>Responsive web development can be tricky at the best of times, but even more so if the site in question has to support any version of Internet Explorer below version 9 (most of the time it's just IE 8 you need to tame due to the low usage statistics of IE &lt;= 7). Old IE makes things harder because media queries (the backbone of responsive websites) aren't supported, so all code inside media query blocks is ignored. Below are the various solutions I've tried out which I wasn't 100% happy with:</p>
<ul>
<li>JS based media query polyfills (<a href="https://github.com/scottjehl/Respond">Respond.js</a>, <a href="https://code.google.com/p/css3-mediaqueries-js/">css3-mediaqueries.js</a>)<br><strong>- Performance issues, also what about users with no JS and old IE?</strong></li>
<li><a href="http://www.jonikorpi.com/leaving-old-IE-behind/">Mobile-first / progressive enhancement</a><br><strong>- This is a great solution, I use a similar method on this site, but what if the client insists the layout needs to look the same on both modern browsers and old IE?</strong></li>
<li>Only ever using <code>max-width</code> based media queries<br><strong>- On larger sites this will lead to horrible CSS as it will require a lot of style resetting at certain breakpoints.</strong></li>
</ul>
<p>The solution I've found to be the best does require a bit of setup but once you're up and running supporting old IE has never been so easy. It also require Sass, in my opinion this functionality alone is enough to try Sass if you haven't before (yes, this solution is that useful). In it's simplest form the file structure consists of:</p>
<pre><code class="language-tex">- project/
  - css/
    - _base.scss
    - _config.scss
    - lt-ie-9.scss
    - style.scss
  - index.html
</code></pre>
<p><code>_base.scss</code> is the file which contains all of your SCSS / CSS, you can write it straight into there or if you prefer to be modular about it you can import all of your CSS components into that file. With no project CSS thrown in there all it's doing is importing the <code>_config.scss</code> file:</p>
<pre><code class="language-scss">@import &quot;config&quot;;
</code></pre>
<p><code>_config.scss</code> contains a map of your common breakpoints along with a media query mixin:</p>
<pre><code class="language-scss">/**
  Specify breakpoints here.
 */
$breakpoints: (
  'small':    '(min-width: 480px)',
  'medium':   '(min-width: 768px)',
  'large':    '(min-width: 1024px)'
);

@mixin media-query($media-query, $lt-ie-9-support: false) {
  /**
    If we're not in the old IE stylesheet, then output the media query block.
   */
  @if $is-lt-ie-9-stylesheet == false {
    @each $name, $declaration in $breakpoints {
      @if $media-query == $name and $declaration {
        @media only screen and #{$declaration} {
          @content;
        }
      }
    }
  }
  /**
    If the media query has been set to support old IE and we are in the old IE
    stylesheet, then output the code inside the media query block but strip the
    actual media query from around it.
   */
  @if $lt-ie-9-support == true and $is-lt-ie-9-stylesheet == true {
    @content;
  }
}
</code></pre>
<p><code>lt-ie-9.scss</code> consists of the following, this file will compile to <code>lt-ie-9.css</code> when ran through a Sass compiler:</p>
<pre><code class="language-scss">$is-lt-ie-9-stylesheet: true;

@import &quot;base&quot;;
</code></pre>
<p><code>style.scss</code> consists of the following, this file will compile to <code>style.css</code> when ran through a Sass compiler:</p>
<pre><code class="language-scss">$is-lt-ie-9-stylesheet: false;

@import &quot;base&quot;;
</code></pre>
<p>Almost done now, the last step is to add the reference to the CSS files into the HTML like so:</p>
<pre><code class="language-markup">&lt;!--[if (lt IE 9) &amp; (!IEMobile)]&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;css/lt-ie-9.css&quot;&gt;
&lt;![endif]--&gt;
&lt;!--[if (gte IE 9) | (IEMobile)]&gt;&lt;!--&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot;&gt;
&lt;!--&lt;![endif]--&gt;
</code></pre>
<p>This tells the browser which CSS file to use based on what browser the page is being view on, if the browser is IE and below version 9 it will load <code>lt-ie-9.css</code>, however if the browser is either IE version 9 and above or not IE at all it will load <code>style.css</code>.</p>
<h2 id="usage">Usage</h2>
<p>In <code>_base.scss</code> you'd write your SCSS / CSS as per normal but when you want to use a media query you'd do it like so:</p>
<pre><code class="language-scss">.element {
  @include media-query(small) {
    width:50%;
  }
}
</code></pre>
<p>If you want the code in the media query to be read by old IE then you just simply add a second argument of <code>true</code> to the <code>media-query</code> <code>@include</code> like so:</p>
<pre><code class="language-scss">.element {
  @include media-query(small, true) {
    width:50%;
  }
}
</code></pre>
<p>The above code will output the following in the <code>style.scss</code> file:</p>
<pre><code class="language-css">@media only screen and (min-width: 480px) {
  .element {
    width:50%;
  }
}
</code></pre>
<p>And the following in the <code>lt-ie-9.scss</code> file, stripping the media query wrapped around it:</p>
<pre><code class="language-css">.element {
  width:50%;
}
</code></pre>
<p>There you have it, almost no effort required to make old IE behave with media queries, I've used this method in a few projects of mine now and I haven't had any issues at all. I actually use this method by default on my personal front-end boilerplate which you can check out <a href="https://github.com/tomblanchard/boilerplate/tree/master/src/scss">here</a>.</p>
<h2 id="otheruses">Other uses</h2>
<p>This isn't just useful for responsive stuff either, it can also be used as an alternative to <a href="https://twitter.com/paul_irish">Paul Irish</a>'s IE <a href="http://www.paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither">conditional classes</a> on the <code>&lt;html&gt;</code> element. With this method you'd target elements being viewed in a specific version of IE like so:</p>
<pre><code class="language-scss">.element {
  /*html*/.lte9 &amp; {
    width:50%;
  }
}
</code></pre>
<p>The problem with that method is the IE specific styles would get loaded be the browsers no matter what browser it is, downloading CSS which doesn't get used is just wasted bytes which can add up and cause a slow-loading site. With the Sass method you'd do it like:</p>
<pre><code class="language-scss">.element {
  @if $is-lt-ie-9-stylesheet == true {
    width:50%;
  }
}
</code></pre>
<p>Or if you want CSS outputted only in the non-IE stylesheet you'd do:</p>
<pre><code class="language-scss">.element {
  @if $is-lt-ie-9-stylesheet != true {
    width:50%;
  }
}
</code></pre>
<p>This way the browser specific CSS only ever gets loaded by the browser which actually needs it, awesome right?</p>
<p>If you're an advocate of OOCSS (Oriented CSS) then you have most likely worked with Sass before as it makes development of OOCSS a lot more efficient. Here's a simple example of an object (stolen / slightly modified from <a href="https://github.com/csswizardry/inuit.css/blob/master/objects/_nav.scss">inuit.css</a>):</p>
<pre><code class="language-scss">.nav {
  margin-left:0;
  margin-bottom:0;
  list-style:none;

  &gt; li {
    &amp;,
    &gt; a {
      display:inline-block;
       *display:inline;
      zoom:1;
    }
  }
}
</code></pre>
<p>This object turns a regular unordered list into a horizontal row of list items, mostly for use in navigation menus. To use this I can just drop in a class in my HTML like so:</p>
<pre><code class="language-markup">&lt;ul class=&quot;nav&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;/home&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/about&quot;&gt;About&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/contact&quot;&gt;Contact&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<p>Alternatively I can use Sass's <code>@extend</code> directive like so:</p>
<pre><code class="language-scss">.menu {
  @extend .nav;
}
</code></pre>
<p>Just recently I've worked on a lot of responsive front-end projects in which the design briefs I'm supplied with involve usage of certain CSS objects that are only active in-between specific breakpoints. If Sass enabled usage of the <code>@extend</code> directive inside media queries then I could just do something like:</p>
<pre><code class="language-scss">.menu {
  @media (min-width:768px) and (max-width:1023px) {
    @extend .nav;
  }
}
</code></pre>
<p>This throws the following error:</p>
<pre><code>You may not @extend an outer selector from within @media.
You may only @extend selectors within the same directive.
</code></pre>
<p>My work around for this is changing the way I author my objects in the first place, instead of limiting the object from just being contained in a class (which limits usage to either a class in the HTML or the <code>@extend</code> directive in Sass) also have it in a mixin, like so:</p>
<pre><code class="language-scss">@mixin nav {
  margin-left:0;
  margin-bottom:0;
  list-style:none;

  &gt; li {
    &amp;,
    &gt; a {
      display:inline-block;
       *display:inline;
      zoom:1;
    }
  }
}
.nav { @include nav; }
</code></pre>
<p>Now when I want to use this object I have three options, I can either drop a class in the HTML, <code>@extend</code> it and thanks to the mixin and I can now <code>@include</code> it. The good thing about mixins is that they can be used pretty much anywhere, even inside of media query blocks, so say I wanted a <code>.nav</code> object which was only active in-between a certain media query I can do it like so (the <code>tablet</code> class prefix is just for brevity, make sure the actual media query specific class names have <a href="http://css-tricks.com/naming-media-queries">context</a>):</p>
<pre><code class="language-scss">@media (min-width:768px) and (max-width:1023px) {
  .tablet-nav {
    @include nav;
  }
}
</code></pre>
<p>This makes it all a lot more <a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a>, there are other ways of doing this like having the object styles active at all times and then undoing those styles during specific media queries but that it far from ideal, but yeah this is my take on the solution and it seems to work quite well. I have open-sourced my own <a href="https://github.com/tomblanchard/boilerplate">personal front-end boilerplate</a> which makes use of this CSS object authoring method, so if you want to check out more examples (including objects with sub-components etc.) then <a href="https://github.com/tomblanchard/boilerplate/tree/master/src/scss/framework/objects">be my guest</a>.</p>
<p>Ever since I started out as a front-end developer I've worked on a PC running Windows, it's served me well over the years, despite all the issues that most people in this industry seem to have with the Windows operating system I don't really have anything to complain about.</p>
<p>I spent a long time mulling over whether or not I was going to join the Apple bandwagon and get a Mac. Well around a month ago I took the plunge and purchased a 13.3-inch MacBook Air and I couldn't be happier with it, I've waited a few weeks to see if this purchase has turned out to be a good investment and it definitely has. The only thing that's caused some problems is transitioning from Windows to OS X which I fully anticipated considering this is my <strong>first</strong> ever Mac.</p>
<h2 id="apps">Apps</h2>
<p>As I'm explicitly a front-end dev it was a breeze setting up the machine for work purposes, as my requirements are very lean. It was just a case of installing all the CLI tools I use (Git, Node, Ruby, Grunt etc.), installing software (Photoshop, Skype etc.) then leaving my Dropbox to download all of my files and boom, ready to <del>twerk</del> work! There were a couple of Windows-only apps I had to sacrifice but it didn't take long to find OS X alternatives, all together, the setting up process was mostly painless.</p>
<p>For a while I've gotten into the habit of using Dropbox for pretty much everything, this includes hosting of my app data, so it's easy to have the same software settings / plugins synced across different machines. I do this mostly for 1Password (all of my login details, encrypted of course), Sublime Text (all settings and packages) and XAMPP (web project files which require a local Apache / SQL server to run). I'm so glad I got everything synced on Dropbox prior to upgrading my work machine, it saved a lot of headaches and it's so efficient because I can pretty much work from any machine (given an hour or two to set it up).</p>
<h3 id="internetexplorer">Internet Explorer</h3>
<p>Just when I thought I was done for good with Windows... It turns out the best way to run IE on Mac machines is through installing virtual machines that run the Windows operating system. This was a bit of a drag to set up due to the huge file sizes of the virtual machine files from <a href="http://modern.ie">Modern.IE</a> and my not-so-great Internet speed but once everything is set up it's pretty painless to test in IE, plus it's kind of cool to see Windows actually running <strong>inside</strong> of OS X.</p>
<h2 id="portability">Portability</h2>
<p>Not only is this my first Mac work machine, it's also my first portable work machine, I've only ever worked on fixed desktop PCs. Most of the time I work with my MacBook connected to a 24-inch monitor but sometimes it's nice to have a change the surroundings where I work from, I've found it makes me a lot more productive compared to staying in the same place for hours on end.</p>
<h2 id="downsides">Downsides</h2>
<p>Though the transition from Windows to OS X has been <em>mostly</em> effortless I have come across a few things that I'm not a huge fan of.</p>
<h3 id="archives">Archives</h3>
<p>With Windows, the native way to handle <code>.zip</code> archive files is quite seamless; it just opens like a native directory. With OS X, when you open one it automatically extracts all the file contents into its own directory in the same directory as the <code>.zip</code> file. This really bugs me; it causes unnecessary clutter and doesn't feel graceful at all. I've tried a few custom OS X archive GUI apps but none seem to function as seamless as I prefer, this isn't a huge deal and I'm sure I'll get used to it.</p>
<h3 id="ds_store">.DS_Store</h3>
<p>This thing drives me crazy, basically OS X comes with a built in app called &quot;Finder&quot;, and it's for navigating around files on the machine's hard drive. Every time you open a directory Finder automatically generates a hidden <code>.DS_Store</code> file which holds meta data about the directory, if you delete it, it comes straight back. You might not think this is a big deal but when you have it so hidden files are visible it get's hugely annoying. It means I have to exclude that file from all directories when working with Git (using <code>.gitignore</code>), it also means that if I upload an entire directory via FTP (which is sometimes needed), all those annoying <code>.DS_Store</code> files come with it.</p>
<h3 id="otherlittlethings">Other little things</h3>
<p>Other things that I've noticed I don't like about OS X are quirks I've grown accustomed to while working on Windows machines all of my life. One thing is that you can't quickly permanently delete files / directories, in Windows it's a simple keyboard shortcut <code>shift + del</code>, but in OS X you have to move the file to Trash then empty the Trash which gets old fast. Another thing I grew fond of in Windows was right clicking in a directory and being able to create a new file there and then, mostly I'd use this when creating new <code>.html</code> / <code>.css</code> files, you can't do this in OS X either, I know it's a very small thing but when you're so used to doing it you grow to miss it.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In the end though I'm smitten for this MacBook and OS X, it's significantly faster than my old Windows machine and a lot more fun to work with. I've always been a lover of Apple, I've had this machine for a few weeks now and I still get blown away with even it's external appearance, the attention to detail Apple put into their products is phenomenal.</p>
<p>This upgrade has made my job easier and a lot more enjoyable, if you're reading this (people read this right?) and are wanting to get a Mac but are worried about switching from Windows to OS X, don't be... do it, do it now!</p>
<p><strong>&quot;How is this done again?&quot;</strong>, those five words I'm noticing I'm asking myself more and more. A lot of the time when I'm working on a project I'll have to accomplish a specific task (which I have done before) which I know how to do, but always forget the best way to go about it, I'm pretty sure I'm not the only one who's guilty of this (I hope!) Most of the time this ends up with me either going back to an older projects code and pasting it from there or having to completely rewrite it which sometimes doesn't even end up as efficient as the original code, both of these solutions aren't really ideal. I suppose I could just whack these easy forgettable tasks into a <a href="https://gist.github.com">GitHub Gist</a> but instead I decided to start this tutorial themed post series so I can hopefully help out a few fellow developers who are in a similar position to me.</p>
<p>This post is focussed around the WordPress loop and manipulating it to display posts within rows and columns in a specific way. To clarify, I was working on a clients site and they wanted their posts to be displayed in a grid system where every two posts were contained in their own wrappers which acted as grid rows (<code>&lt;div class=&quot;row&quot;&gt;&lt;/div&gt;</code>), so the HTML outputted by the loop had to be like so:</p>
<pre><code class="language-markup">&lt;div class=&quot;row&quot;&gt;
  &lt;article&gt;
    &lt;a href=&quot;http://post-link&quot;&gt;Post title&lt;/a&gt;
  &lt;/article&gt;
  &lt;article&gt;
    &lt;a href=&quot;http://post-link&quot;&gt;Post title&lt;/a&gt;
  &lt;/article&gt;
&lt;/div&gt;

&lt;div class=&quot;row&quot;&gt;
  &lt;article&gt;
    &lt;a href=&quot;http://post-link&quot;&gt;Post title&lt;/a&gt;
  &lt;/article&gt;
  &lt;article&gt;
    &lt;a href=&quot;http://post-link&quot;&gt;Post title&lt;/a&gt;
  &lt;/article&gt;
&lt;/div&gt;
</code></pre>
<h2 id="coolnowwheresthecode">Cool, now where's the code!?</h2>
<p>To accomplish the loop outputting the posts in this fashion I had to make use of the PHP <code>modulus</code> and <code>post-increment</code> operators, the loop I used is shown below (commented to clarify what each snippet is for):</p>
<pre><code class="language-php">&lt;?php if (have_posts()) : ?&gt;

  &lt;?php
    /**
     * Start post counter at 0.
     */
    $i = 0;
    while (have_posts()) : the_post();
    /**
     * Define the number of posts displayed per row.
     */
    $posts_per_row = 2;
    /**
     * HTML of the row opening &amp; closing tags.
     */
    $open = '&lt;div class=&quot;row&quot;&gt;';
    $close = '&lt;/div&gt;';
    /**
     * Output HTML of the row opening &amp; closing tags when and where they should be
     * outputted.
     */
    echo !($i % $posts_per_row) &amp;&amp; $i ? $close : '',
         !($i % $posts_per_row) ? $open : '';

    /**
     * Regular post loop stuff below.
     */
  ?&gt;

    &lt;article&gt;
      &lt;a href=&quot;&lt;?php the_permalink(); ?&gt;&quot;&gt;&lt;?php the_title(); ?&gt;&lt;/a&gt;
    &lt;/article&gt;

  &lt;?php
    /**
     * Update post counter throughout each post iterated over.
     */
    $i++;
    endwhile;
    /**
     * Output HTML of the row closing tag again (this is needed in case there aren't
     * the same number of posts in each row).
     */
    echo ($i) ? $close : '';
  ?&gt;

&lt;?php endif; ?&gt;
</code></pre>
<p>Sorted, now the posts are perfectly contained in their own rows and columns and there's never any unclosed HTML elements etc. (some other tutorials on how to accomplish this fall victim to this.) All HTML outputted is always valid and one of the best things about this is that it works perfectly with pagination, I thought it would throw a spanner in the works but nope, it just works.</p>
<h2 id="thishasotherusesto">This has other uses to!</h2>
<p>I've found this  method can also be useful when you need to display posts in a carousel / slideshow, I did this when I developed a re-design of a clients site, one of the features were that the posts were displayed by their thumbnail inside an image carousel using the jQuery plugin <a href="http://jquery.malsup.com/cycle2">Cycle2</a>, you can see that in action on the live site <a href="http://goo.gl/5Gglb2">http://goo.gl/5Gglb2</a>. The HTML the loop outputted the posts in had to be structured like so:</p>
<pre><code class="language-markup">&lt;ul&gt;
  &lt;li&gt;
    &lt;img src=&quot;http://post-thumbnail&quot; alt=&quot;&quot;&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;img src=&quot;http://post-thumbnail&quot; alt=&quot;&quot;&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;img src=&quot;http://post-thumbnail&quot; alt=&quot;&quot;&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;img src=&quot;http://post-thumbnail&quot; alt=&quot;&quot;&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;img src=&quot;http://post-thumbnail&quot; alt=&quot;&quot;&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;img src=&quot;http://post-thumbnail&quot; alt=&quot;&quot;&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<p>All I needed to do to accomplish this was to change a few loop variables; <code>$posts_per_row</code> to <code>3</code>, <code>$open</code> to <code>&lt;ul&gt;</code>, <code>$close</code> to <code>&lt;/ul&gt;</code> and voila, done!</p>
<p>I'll no doubt be back extending the <strong>&quot;How is this done again?&quot;</strong> post series soon, I seem to be way too good at forgetting code not to.</p>
<p>If you haven't heard of <a href="http://gruntjs.com">Grunt</a> (if so, where have you been hiding?), it's a task runner powered by JavaScript and <a href="http://nodejs.org">Node.js</a>, don't worry, you don't have to be a JavaScript / Node.js developer to use Grunt (just like you don't have to be a <a href="http://ruby-lang.org">Ruby</a> developer to use <a href="http://sass-lang.com">Sass</a>). You can use it for a <strong>lot</strong> of things thanks to the community for publishing so many plugins, a couple of examples being <a href="http://github.com/gruntjs/grunt-contrib-cssmin">Cssmin</a> (CSS compression) and <a href="http://github.com/gruntjs/grunt-contrib-uglify">Uglify</a> (JavaScript minification).</p>
<p>This post assumes you're at least a little bit familiar with Grunt so I'm not going to write up a tutorial on how to install Grunt and its dependencies, in a nutshell you set up your <code>Gruntfile.js</code> file and configure tasks and plugins to do what you want, when you want. When you've got all your tasks set up, you just run the <code>grunt</code> command (which runs the default task) and you're all set, or if you have multiple tasks you'd run <code>grunt task-name</code>.</p>
<p>Also, if you were wondering about the title of this post, it's reffering to the fact that ever since I had my Grunt &quot;aha&quot; moment I haven't been able to stop from myself sharing its power with people. Yep it's that awesome it even caused me to come up with that awfully lame form of wordplay!</p>
<h2 id="whatiusegruntfor">What I use Grunt for</h2>
<p>On this site I use Grunt for a lot of things (short of dressing and feeding me), a lot of what I use it for on this site is very specific to this site as a whole and there will be a lot of things in there most projects won't need, I've heavily commented my <code>Gruntfile.js</code> file so it makes as much sense as possible and which snippets do which task and why I want them in place. I have also noted down which plugins I have used with links to them.</p>
<p>Below is my <code>Gruntfile.js</code> setup:</p>
<pre><code class="language-javascript">module.exports = function(grunt) {

  /**
   * Instead of loading each task one by one using `grunt.loadNpmTasks`,
   * automatically load all dependencies from the `package.json` file.
   *
   * Plugin: http://github.com/sindresorhus/load-grunt-tasks
   */
  require('load-grunt-tasks')(grunt);

  grunt.initConfig({

    pkg: grunt.file.readJSON('package.json'),




    /**
     * Start a local server using the compiled Jekyll site directory as the base.
     *
     * Plugin: http://github.com/gruntjs/grunt-contrib-connect
     */
    connect: {
      server: {
        options: {
          hostname: '*',
          port: 12000,
          base: '_site'
        }
      }
    },


    /**
     * Compile Sass files to CSS files.
     *
     * Plugin: http://github.com/gruntjs/grunt-contrib-sass
     */
    sass: {
      dist: {
        options: {
          style: 'compressed'
        },
        files: [{
          expand: true,
          cwd: 'lib/css',
          src: ['**/*.scss'],
          dest: 'lib/css',
          ext: '.min.css'
        }]
      }
    },


    /**
     * Uglify (minify) `main.js` file.
     *
     * Plugin: http://github.com/gruntjs/grunt-contrib-uglify
     */
    uglify: {
      dist: {
        files: {
          'lib/js/main.min.js': 'lib/js/main.js'
        }
      }
    },


    /**
     * Build Jekyll site.
     *
     * Plugin: http://github.com/dannygarcia/grunt-jekyll
     */
    jekyll: {
      dist: {
        options: {
          bundleExec: true
        }
      }
    },


    /**
     * Minify all HTML / PHP files that Jekyll builds.
     *
     * Plugin: http://github.com/gruntjs/grunt-contrib-htmlmin
     */
    htmlmin: {
      dist: {
        options: {
          removeComments: true,
          collapseWhitespace: true
        },
        files: [{
          expand: true,
          cwd: '_site',
          src: ['**/*.{html,php}'],
          dest: '_site'
        }]
      }
    },


    /**
     * Instead of getting Jekyll to rebuild every time a file in `lib` is changed
     * (slow), copy and replace the old `lib` with the new one in the compiled Jekyll
     * site directory. This only gets ran during the `watch` task because Jekyll
     * does it on the initial build.

     * Plugin: https://github.com/gruntjs/grunt-contrib-copy
     */
    copy: {
      lib : {
        files: [{
          expand: true,
          src: ['lib/**/*'],
          dest: '_site'
        }]
      }
    },


    /**
     * Runs tasks against changed watched files.
     *
     * Plugin: http://github.com/gruntjs/grunt-contrib-watch
     */
    watch: {
      /**
       * Watch any Sass files, if any are modified, recompile them to CSS.
       */
      sass: {
        files: 'lib/css/**/*.scss',
        tasks: ['sass'],
        options: {
          spawn: true
        }
      },

      /**
       * Watch any JavaScript files, if any are modified, reuglify them.
       */
      uglify: {
        files: 'lib/js/main.js',
        tasks: ['uglify'],
        options: {
          spawn: false
        }
      },

      /**
       * Watch any Jekyll related files, if any are modified, rebuild and minify the Jekyll site,
       */
      jekyll: {
        files: ['_includes/**/*', '_layouts/**/*', '_plugins/**/*', '_posts/**/*', '*.html', '_config.yml', '_site/**/*.{html,php}'],
        tasks: ['jekyll', 'htmlmin'],
        options: {
          spawn: false
        }
      },

      /**
       * Watch any files in the `lib` directory, if any are modified, copy and replace
       * that directory to the compiled Jekyll site directory (instead of getting Jekyll
       * to rebuild the entire site every time a file in `lib` is modified which is a lot
       * slower).
       */
      copy: {
        files: ['lib/**/*'],
        tasks: ['copy'],
        options: {
          spawn: false
        }
      }
    },


    /**
     * Upload (and replace the old files) the compiled Jekyll site directory to the
     * server.
     *
     * 1. For some reason when Jekyll builds the site files, it builds random `pageN`
     *    directories in the compiled site root directory, this isn't a major problem,
     *    just an annoyance. This stops these directories getting uploaded to the server.
     * 2. Certain files which should be kept on the server even when they are not
     *    presented locally.
     *
     * Plugin: http://github.com/inossidabile/grunt-ftpush
     */
    ftpush: {
      dist: {
        auth: {
          host: 'tomblanchard.co.uk',
          port: 21,
          authKey: 'tomblanchard.co.uk'
        },
        src: '_site',
        dest: '/public_html/root',
        exclusions: ['page*', '!**/*/page*'], /* [1] */
        keep: ['googlea67e882a592198c5.html', 'favicon.ico'] /* [2] */
      }
    },


    /**
     * Run command line tools.
     *
     * Plugin: http://github.com/sindresorhus/grunt-shell
     */
    shell: {
      /**
       * Push the uncompiled Jekyll source code to GitHub.
       *
       * 1. Updates the Git index (including deleted files).
       * 2. Commits any changes, with the commit message as the current date and time.
       * 3. Pushes changes to the remote repository.
       */
      git: {
        command: [
          'git add -A', /* [1] */
          'git commit -m &quot;&lt;%= grunt.template.today(&quot;isoDateTime&quot;) %&gt;&quot;', /* [2] */
          'git push' /* [3] */
        ].join('&amp;&amp;')
      }
    }




  });

  /**
   * The `default` task, it builds / compiles the site, then watches for changes,
   * then rebuilds / recompiles.
   *
   * Usage: `grunt` or `grunt default`
   */
  grunt.registerTask('default', [
    'connect',
    'sass',
    'uglify',
    'jekyll',
    'htmlmin',
    'watch'
  ]);


  /**
   * The `push` task, it uploads the compiled site to the server then pushes
   * uncompiled Jekyll source code to GitHub.
   *
   * Usage: `grunt push`
   */
  grunt.registerTask('push', [
    'ftpush',
    'shell'
  ]);

};
</code></pre>
<p>So there you have it, go fourth and learn!</p>
        
      </div>
    </article>
  </div>
</div>


    </main>

    <footer class="box-color-definitions-1 text-color-definitions-2">
  <div class="padding-top-bottom--up-3">
    <div class="container-default">
      <div class="medium--flex-bar--up-1 medium--flex-reverse">
        <div class="medium--flex-item-shrink margin-bottom--down-1 medium--margin-bottom--none">
          



<ul class="grid-bar--0 margin-bottom--none">
  
    

    <li class="grid-item">
      <a class="text-color-inherit" href="https://linkedin.com/in/tom-blanchard-7b906a163" target="_blank">
        <div class="font-size--up-8">
          
          <svg viewBox="0 0 26 26">
  <circle cx="13" cy="13" r="13"/><path d="M9.557 19h-2.36V9.947h2.36V19zM8.377 8.904C7.617 8.904 7 8.254 7 7.452 7 6.65 7.617 6 8.377 6s1.377.65 1.377 1.452c0 .801-.616 1.452-1.377 1.452zM19 19h-2.36v-4.612c0-2.772-3.148-2.562-3.148 0V19h-2.36V9.947h2.36V11.4C14.59 9.27 19 9.114 19 13.437V19z" fill="#000" fill-rule="nonzero"/>
</svg>

        </div>
      </a>
    </li>
  
    

    <li class="grid-item">
      <a class="text-color-inherit" href="https://twitter.com/tomblanchardCSS" target="_blank">
        <div class="font-size--up-8">
          
          <svg viewBox="0 0 26 26">
  <circle cx="13" cy="13" r="13"/><path d="M20.167 7.539a5.963 5.963 0 01-1.787.517 3.262 3.262 0 001.368-1.816 6.041 6.041 0 01-1.976.796A3.034 3.034 0 0015.5 6c-2.009 0-3.485 1.977-3.031 4.03-2.585-.137-4.878-1.444-6.413-3.43-.815 1.476-.423 3.405.962 4.382a2.977 2.977 0 01-1.408-.41c-.034 1.52.999 2.942 2.495 3.26a2.962 2.962 0 01-1.405.055c.396 1.304 1.544 2.252 2.907 2.279A6.026 6.026 0 015 17.526 8.48 8.48 0 009.77 19c5.777 0 9.041-5.146 8.844-9.762a6.539 6.539 0 001.553-1.699z" fill="#000" fill-rule="nonzero"/>
</svg>

        </div>
      </a>
    </li>
  
    

    <li class="grid-item">
      <a class="text-color-inherit" href="http://github.com/tomblanchard" target="_blank">
        <div class="font-size--up-8">
          
          <svg viewBox="0 0 26 26">
  <circle cx="13" cy="13" r="13"/><path d="M13 4c-4.97 0-9 4.132-9 9.228 0 4.077 2.579 7.535 6.155 8.756.45.085.595-.201.595-.444v-1.718c-2.503.558-3.025-1.089-3.025-1.089-.41-1.066-1-1.35-1-1.35-.816-.573.063-.56.063-.56.904.064 1.379.95 1.379.95.803 1.41 2.105 1.003 2.619.767.08-.596.314-1.003.572-1.233-2-.235-4.1-1.026-4.1-4.56 0-1.009.351-1.832.926-2.478-.093-.233-.401-1.172.088-2.442 0 0 .756-.247 2.476.946A8.432 8.432 0 0113 8.463a8.457 8.457 0 012.255.31c1.718-1.193 2.472-.946 2.472-.946.49 1.271.182 2.21.089 2.442.577.646.926 1.47.926 2.477 0 3.544-2.105 4.325-4.11 4.553.323.286.618.848.618 1.709v2.532c0 .245.144.534.6.443 3.575-1.222 6.15-4.68 6.15-8.755C22 8.132 17.97 4 13 4z" fill="#000" fill-rule="nonzero"/>
</svg>

        </div>
      </a>
    </li>
  
</ul>

        </div>

        <div class="medium--flex-item">
          <small>
            &copy; Forever and ever, maybe ðŸ˜…
          </small>
        </div>
      </div>
    </div>
  </div>
</footer>


    
      <script src="https://tomblanchard.co.uk/assets/prism.min.js?v=8bd22fdfeb"></script>
    
  </body>
</html>
